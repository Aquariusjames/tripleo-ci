---
# zuul.d/multinode-jobs.yaml
# Zuul layout for TripleO multinode jobs.
# It contains all the jobs using deployed-servers in nodepool.

- project-template:
    name: tripleo-multinode-baremetal-minimal
    check:
      jobs:
        - tripleo-ci-centos-7-3nodes-multinode
        - tripleo-ci-centos-7-nonha-multinode-oooq
    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-7-nonha-multinode-oooq

- project-template:
    name: tripleo-multinode-container-minimal
    check:
      jobs:
        - tripleo-ci-centos-7-containers-multinode
        - tripleo-ci-centos-7-undercloud-containers
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-updates
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-upgrades
        - tripleo-ci-centos-7-standalone

    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-7-containers-multinode
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-updates

- project-template:
    name: tripleo-multinode-container-full
    check:
      jobs:
        - tripleo-ci-centos-7-containers-multinode
        - tripleo-ci-centos-7-undercloud-containers
        - tripleo-ci-centos-7-scenario001-multinode-oooq-container
        - tripleo-ci-centos-7-scenario002-multinode-oooq-container
        - tripleo-ci-centos-7-scenario003-multinode-oooq-container
        - tripleo-ci-centos-7-scenario004-multinode-oooq-container
        - tripleo-ci-centos-7-scenario007-multinode-oooq-container
        - tripleo-ci-centos-7-scenario008-multinode-oooq-container
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-updates
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-upgrades
        - tripleo-ci-centos-7-standalone
    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-7-containers-multinode
        - tripleo-ci-centos-7-scenario001-multinode-oooq-container
        - tripleo-ci-centos-7-scenario002-multinode-oooq-container
        - tripleo-ci-centos-7-scenario003-multinode-oooq-container
        - tripleo-ci-centos-7-scenario004-multinode-oooq-container
        - tripleo-ci-centos-7-scenario007-multinode-oooq-container
        - tripleo-ci-centos-7-scenario000-multinode-oooq-container-updates

- project-template:
    name: tripleo-multinode-baremetal-full
    check:
      jobs:
        - tripleo-ci-centos-7-3nodes-multinode
        - tripleo-ci-centos-7-nonha-multinode-oooq
        - tripleo-ci-centos-7-scenario001-multinode-oooq
        - tripleo-ci-centos-7-scenario002-multinode-oooq
        - tripleo-ci-centos-7-scenario003-multinode-oooq
        - tripleo-ci-centos-7-scenario004-multinode-oooq
        - tripleo-ci-centos-7-scenario007-multinode-oooq
        - tripleo-ci-centos-7-scenario009-multinode-oooq
    gate:
      queue: tripleo
      jobs:
        - tripleo-ci-centos-7-nonha-multinode-oooq
        - tripleo-ci-centos-7-scenario001-multinode-oooq
        - tripleo-ci-centos-7-scenario002-multinode-oooq
        - tripleo-ci-centos-7-scenario003-multinode-oooq
        - tripleo-ci-centos-7-scenario004-multinode-oooq
        - tripleo-ci-centos-7-scenario007-multinode-oooq

- project-template:
    name: tripleo-multinode-experimental
    experimental:
      jobs:
        - tripleo-ci-centos-7-scenario006-multinode-oooq
        - tripleo-ci-centos-7-scenario010-multinode-oooq-container
        - tripleo-ci-centos-7-scenario011-multinode-oooq-container

- project-template:
    name: tripleo-multinode-branchful
    check:
      jobs:
        - tripleo-ci-centos-7-containers-multinode-rocky
        - tripleo-ci-centos-7-containers-multinode-queens
        - tripleo-ci-centos-7-containers-multinode-pike

- job:
    name: tripleo-ci-centos-7-3nodes-multinode
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    nodeset: three-centos-7-nodes
    branches: ^(?!stable/(newton|ocata|pike)).*$
    vars:
      toci_jobtype: multinode-2ctlr-featureset032
      environment_type: multinode
      nodes: 2ctlr
      featureset: '032'

- job:
    name: tripleo-ci-centos-7-containers-multinode
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset010
      environment_type: multinode
      nodes: 1ctlr
      featureset: '010'

- job:
    name: tripleo-ci-centos-7-containers-multinode-rocky
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: master
    vars:
      toci_jobtype: multinode-1ctlr-featureset010
      branch_override: 'stable/rocky'
      environment_type: multinode
      nodes: 1ctlr
      featureset: '010'

- job:
    name: tripleo-ci-centos-7-containers-multinode-queens
    parent: tripleo-ci-base
    timeout: 10800
    branches: master
    vars:
      toci_jobtype: multinode-1ctlr-featureset010
      branch_override: 'stable/queens'
      environment_type: multinode
      nodes: 1ctlr
      featureset: '010'

- job:
    name: tripleo-ci-centos-7-containers-multinode-pike
    parent: tripleo-ci-base
    timeout: 10800
    branches: master
    vars:
      toci_jobtype: multinode-1ctlr-featureset010
      branch_override: 'stable/pike'
      environment_type: multinode
      nodes: 1ctlr
      featureset: '010'

- job:
    name: tripleo-ci-centos-7-nonha-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/(newton|ocata).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset004
      environment_type: multinode
      nodes: 1ctlr
      featureset: '004'

- job:
    name: tripleo-ci-centos-7-scenario001-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/(newton|ocata).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset005
      environment_type: multinode
      nodes: 1ctlr
      featureset: '005'

- job:
    name: tripleo-ci-centos-7-scenario001-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset016
      environment_type: multinode
      nodes: 1ctlr
      featureset: '016'

- job:
    name: tripleo-ci-centos-7-scenario002-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/(newton|ocata).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset006
      environment_type: multinode
      nodes: 1ctlr
      featureset: '006'

- job:
    name: tripleo-ci-centos-7-scenario002-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset017
      environment_type: multinode
      nodes: 1ctlr
      featureset: '017'

- job:
    name: tripleo-ci-centos-7-scenario002-multinode-oooq-container-refstack
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset055
      environment_type: multinode
      nodes: 1ctlr
      featureset: '055'

- job:
    name: tripleo-ci-centos-7-scenario003-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/ocata.*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset007
      environment_type: multinode
      nodes: 1ctlr
      featureset: '007'

- job:
    name: tripleo-ci-centos-7-scenario003-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset018
      environment_type: multinode
      nodes: 1ctlr
      featureset: '018'

- job:
    name: tripleo-ci-centos-7-scenario004-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/ocata.*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset008
      environment_type: multinode
      nodes: 1ctlr
      featureset: '008'

- job:
    name: tripleo-ci-centos-7-scenario004-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset019
      environment_type: multinode
      nodes: 1ctlr
      featureset: '019'

- job:
    name: tripleo-ci-centos-7-scenario006-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset026
      environment_type: multinode
      nodes: 1ctlr
      featureset: '026'

- job:
    name: tripleo-ci-centos-7-scenario007-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^stable/pike.*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset028
      environment_type: multinode
      nodes: 1ctlr
      featureset: '028'

- job:
    name: tripleo-ci-centos-7-scenario007-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    branches: ^(?!stable/(newton|ocata|pike)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset030
      environment_type: multinode
      nodes: 1ctlr
      featureset: '030'

- job:
    name: tripleo-ci-centos-7-scenario008-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata|pike)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset031
      environment_type: multinode
      nodes: 1ctlr
      featureset: '031'

- job:
    name: tripleo-ci-centos-7-scenario008-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata|pike|queens)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset031
      environment_type: multinode
      nodes: 1ctlr
      featureset: '031'

- job:
    name: tripleo-ci-centos-7-scenario009-multinode-oooq
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset033
      environment_type: multinode
      nodes: 1ctlr
      featureset: '033'

- job:
    name: tripleo-ci-centos-7-scenario010-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata|pike)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset038
      environment_type: multinode
      nodes: 1ctlr
      featureset: '038'

- job:
    name: tripleo-ci-centos-7-scenario000-multinode-oooq-container-updates
    description: |
      Basic tripleo update job, this is not an upgrade job.
    parent: tripleo-ci-base
    timeout: 10800
    voting: true
    branches: ^(?!stable/(newton|ocata|pike|queens)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset037
      environment_type: multinode
      nodes: 1ctlr
      featureset: '037'
      # Note (dmsimard): This enforces a minimum TTL for DNS records, see
      # https://review.openstack.org/#/c/523178/ for context
      unbound_cache_min_ttl: 900

- job:
    name: tripleo-ci-centos-7-scenario011-multinode-oooq-container
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset044
      environment_type: multinode
      nodes: 1ctlr
      featureset: '044'

- job:
    name: tripleo-ci-centos-7-scenario000-multinode-oooq-container-upgrades
    parent: tripleo-ci-base
    timeout: 10800
    voting: false
    branches: ^(?!stable/(newton|ocata)).*$
    vars:
      toci_jobtype: multinode-1ctlr-featureset051
      environment_type: multinode
      nodes: 1ctlr
      featureset: '051'
